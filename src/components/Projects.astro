---
import ProjectCard from './ProjectCard';
import type { ImageMetadata } from 'astro';
import { getLangFromUrl, useTranslations } from '../i18n/utils';
import { projects as projectsData } from '../data/projects';

const lang = getLangFromUrl(Astro.url);
const t = useTranslations(lang);

// Import all images from the projects folder
const allImages = import.meta.glob<{ default: ImageMetadata }>('/src/assets/projects/**/*.{jpeg,jpg,png,gif,webp,JPEG,JPG,PNG,GIF,WEBP}');

// Helper function to get images for a specific project folder
async function getProjectImages(folderName: string) {
  const images: string[] = [];
  
  for (const path in allImages) {
    if (path.includes(`/projects/${folderName}/`)) {
      const imageModule = await allImages[path]();
      images.push(imageModule.default.src);
    }
  }
  
  return images;
}

// Enrich projects with images
const projects = await Promise.all(projectsData[lang].map(async (project) => {
  const images = await getProjectImages(project.imageFolder);
  // Fallback if no images found in folder
  if (images.length === 0) {
      // Use placeholder or keep empty to show "No images"
      // For now, let's keep it empty so user knows they need to add images
  }
  return { ...project, images };
}));
---

<section id="projects" class="py-20">
  <div class="max-w-6xl mx-auto px-4 sm:px-6 lg:px-8">
    <div class="text-center mb-16">
      <h2 class="text-3xl md:text-4xl font-bold mb-4">{t('projects.title')}</h2>
      <div class="w-20 h-1 bg-primary mx-auto rounded-full"></div>
      <p class="mt-4 text-slate-400 max-w-2xl mx-auto">
        {t('projects.description')}
      </p>
    </div>

    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8">
      {projects.map((project) => (
        <ProjectCard client:visible project={project} />
      ))}
    </div>
  </div>
</section>
